import React, { useEffect, useRef, useState } from "react";
import { findNext, findPrevious, clearSearch } from "find-in-page-js";
import { X, ChevronUp, ChevronDown } from "lucide-react";

interface BrowserSearchBarProps {
  visible: boolean;
  onClose: () => void;
}

const BrowserSearchBar: React.FC<BrowserSearchBarProps> = ({ visible, onClose }) => {
  const [term, setTerm] = useState("");
  const inputRef = useRef<HTMLInputElement>(null);

  useEffect(() => {
    if (visible) {
      // focus when opened
      setTimeout(() => inputRef.current?.focus(), 80);
    } else {
      clearSearch();
      setTerm("");
    }
  }, [visible]);

  if (!visible) return null;

  return (
    <div
      style={{
        position: "fixed",
        top: "12px",
        right: "12px",
        background: "#fff",
        border: "1px solid #ccc",
        boxShadow: "0 2px 6px rgba(0,0,0,0.2)",
        borderRadius: "6px",
        padding: "6px 8px",
        zIndex: 9999,
        display: "flex",
        alignItems: "center",
        gap: "6px",
        fontFamily: "system-ui, sans-serif",
      }}
    >
      <input
        ref={inputRef}
        value={term}
        onChange={(e) => setTerm(e.target.value)}
        onKeyDown={(e) => {
          if (e.key === "Enter" && term.trim()) findNext(term);
        }}
        placeholder="Find in page..."
        style={{
          border: "1px solid #ddd",
          borderRadius: "4px",
          padding: "4px 6px",
          fontSize: "13px",
          width: "180px",
          outline: "none",
        }}
      />
      <button
        onClick={() => findPrevious(term)}
        style={{ border: "none", background: "none", cursor: "pointer" }}
        title="Previous"
      >
        <ChevronUp size={16} />
      </button>
      <button
        onClick={() => findNext(term)}
        style={{ border: "none", background: "none", cursor: "pointer" }}
        title="Next"
      >
        <ChevronDown size={16} />
      </button>
      <button
        onClick={() => {
          clearSearch();
          setTerm("");
          onClose();
        }}
        style={{ border: "none", background: "none", cursor: "pointer" }}
        title="Close"
      >
        <X size={16} />
      </button>
    </div>
  );
};

export default BrowserSearchBar;
